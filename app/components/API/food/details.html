<div class="col-sm-12">
    <div class="row">
        <div class="col-sm-8 col-sm-offset-2 vcenter">
            <h1 class="text-center no-vertical-margin">{{ food_item.name }}</h1>
        </div>
    </div>

    <br />

    <div class="row">
        <div class="col-sm-12">
            <form class="form-inline" role="form" ng-submit="query(query_qty, query_type)" ng-if="user.can('add_transaction')">
                <select class="form-control" ng-model="query_type" ng-options="option.name as option.value for option in actions">
                </select>
                <input type="number" class="form-control number" step="any" ng-model="query_qty" select-on-click />
                <div class="checkbox unit">
                    {{ food_item.unit_name == '' && (food_item.name|affs:query_qty) || food_item.unit_name }}
                </div>
                <input type="submit" class="btn btn-success" value="Valider{{ query_qty > 0 && ' pour ' + ((query_qty*food_item.price*food_item.unit_value) | currency) || '' }}" ng-class="query_qty <= 0 && 'disabled' || ''" />
            </form>
        </div>
    </div>

    <br />

    <div class="row">
        <div class="col-sm-12">
            <tabset>
                <tab heading="Infos">
                    <div class="row">
                        <table class="table table-tab">
                            <tbody>
                                <tr>
                                    <td class="h4 title">Prix</td>
                                    <td class="end-of-column text-right value">
                                        <span class="h4"><span class="label label-info">
                                            <bars:food:price food="food_item" in="'sell'" qty="1"></bars:food:price>
                                        </span></span>
                                    </td>
                                    <td class="h4 title">Vols</td>
                                    <td class="text-right value">
                                        <span class="h4"><span class="label label-warning">
                                            12 %
                                        </span></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="h4">Stock</td>
                                    <td class="end-of-column text-right" ng-mouseenter="in = true" ng-mouseleave="in = false">
                                        <span class="h4" ng-hide="in">
                                            <span class="label" ng-class="food_item.qty > 0 && 'label-primary' || 'label-warning'">
                                                <bars:food:qty food="food_item" qty="food_item.qty" out="'sell'"></bars:food:qty>
                                            </span>
                                        </span>
                                        <span class="h4" ng-show="in">
                                            <a class="btn btn-xs btn-warning" tooltip="Signaler aux respos bar que ce produit n'est plus disponible">Signaler qu'il n'y en a plus</a>
                                        </span>
                                    </td>
                                    <td class="h4">Rang</td>
                                    <td class="text-right">
                                        <span class="h4"><span class="badge">
                                            1
                                        </span></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </tab>
                <tab heading="Graphiques">
                    <div class="row">
                        <div class="col-sm-12 text-center">
                            <h1>ICI un BÔÔÔ GRAPHIQUE</h1>
                        </div>
                    </div>
                </tab>
                <tab heading="Modifier" ng-if="user.can('change_item')">
                    <div class="row">
                        <div class="col-sm-9">
                            <form class="form-horizontal" role="form">
                                <div class="form-group">
                                    <label for="name" class="col-sm-4 control-label">Nom</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" id="name" ng-model="newFood_item.name">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="keywords" class="col-sm-4 control-label">Mots clés</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" id="keywords" ng-model="newFood_item.keywords">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="buy_unit" class="col-sm-4 control-label">Unité d'achat</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" id="buy_unit" ng-model="newFood_item.buy_unit_name" placeholder="Lorsque le bar achète l'aliment">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="unit" class="col-sm-4 control-label">Unité de vente</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" id="unit" ng-model="newFood_item.unit_name" ng-change="computeNewPrice()" placeholder="Lorsque qu'un élève achète l'aliment au bar">
                                    </div>
                                </div>
                                <div class="form-group" ng-show="newFood_item.buy_unit_name != food_item.buy_unit_name">
                                    <label for="ratioNewBuyUnit" class="col-sm-4 control-label">1 {{ newFood_item.buy_unit_name || newFood_item.name }} = </label>
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control" id="ratioNewBuyUnit" ng-model="newFood_item.new_buy_unit_value">
                                    </div>
                                    <label class="col-sm-2 control-label">{{ food_item.buy_unit_name || food_item.name }}</label>
                                </div>
                                <div class="form-group" ng-show="newFood_item.unit_name != food_item.unit_name">
                                    <label for="ratioNewUnit" class="col-sm-4 control-label">1 {{ newFood_item.unit_name || newFood_item.name }} = </label>
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control" id="ratioNewUnit" ng-model="newFood_item.new_unit_value" ng-change="computeNewPrice()">
                                    </div>
                                    <label class="col-sm-2 control-label">{{ food_item.unit_name || food_item.name }}</label>
                                </div>
                                <div class="form-group">
                                    <label for="price" class="col-sm-4 control-label">Prix de vente</label>
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control" id="price" ng-model="newFood_item.price">
                                    </div>
                                    <label class="col-sm-2 control-label">€ / {{ newFood_item.unit_name || newFood_item.name }}</label>
                                </div>
                                <div class="form-group" ng-show="newFood_item.price != (food_item.price*food_item.unit_value)">
                                    <label class="col-sm-6 control-label">Ancienne valeur présente dans le bar</label>
                                    <label class="col-sm-6 control-label">
                                        <span class="label label-info">{{ food_item.qty*food_item.price | currency }}</span>
                                    </label>
                                </div>
                                <div class="form-group" ng-show="newFood_item.price != (food_item.price*food_item.unit_value)">
                                    <label class="col-sm-6 control-label">Nouvelle valeur présente dans le bar</label>
                                    <label class="col-sm-6 control-label">
                                        <span class="label label-info">{{ food_item.qty/food_item.unit_value*newFood_item.price/newFood_item.new_unit_value | currency }}</span>
                                    </label>
                                </div>
                                <div class="form-group" ng-show="newFood_item.unit_name != food_item.unit_name">
                                    <label class="col-sm-6 control-label">Ancienne quantité présente dans le bar</label>
                                    <label class="col-sm-6 control-label">
                                        <span class="label label-info">{{ food_item.qty/food_item.unit_value | number }} {{ food_item.unit_name }}</span>
                                    </label>
                                </div>
                                <div class="form-group" ng-show="newFood_item.unit_name != food_item.unit_name">
                                    <label class="col-sm-6 control-label">Nouvelle quantité présente dans le bar</label>
                                    <label class="col-sm-6 control-label">
                                        <span class="label label-info">{{ food_item.qty/newFood_item.new_unit_value/food_item.unit_value | number }} {{ newFood_item.unit_name }}</span>
                                    </label>
                                </div>
                            </form>
                        </div>
                        <div class="col-sm-3 text-right">
                            <div class="btn-group-vertical">
                                <a type="submit" class="btn btn-primary" ng-click="editFood()">
                                    <span class="glyphicon glyphicon-ok"> Valider</span>
                                </a>
                                <a type="submit" class="btn btn-info" ng-click="resetFood()">
                                    <span class="glyphicon glyphicon-remove"> Annuler</span>
                                </a>
                                <a class="btn btn-warning" ng-class="food_item.unavailable && 'active'" ng-click="toggleHidden()">
                                    <span class="glyphicon glyphicon-eye-close"> Cacher</span>
                                </a>
                                <a class="btn btn-danger" ng-class="food_item.deleted && 'active'" ng-click="toggleDeleted()">
                                    <span class="glyphicon glyphicon-trash"> Supprimer</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </tab>
            </tabset>
        </div>
    </div>
    
    <bars:history filter="{item: food_item.id}"></bars:history>
</div>

<!-- <div class="container-fluid">
    <div class="row">
        <div class="col-sm-offset-7 col-sm-5">
            <input type="search" class="form-control" ng-model="queryh" placeholder="Rechercher dans l'historique" id="queryh" />
        </div>
    </div>
</div>

<br /><br /> -->

<div class="container-fluid"><div class="row">
    <div class="col-sm-12">
        <div ng-repeat="d in history_dates | orderBy:'-date'" class="panel panel-default">
            <div class="panel-heading">
                <h2 class="panel-title text-center text-capitalizefirst">{{ d.date | amCalendar }}</h2>
            </div>
            <table class="table table-striped table-hover table-condensed history">
                <tr ng-repeat="transaction in history_by_date[d.date] | filter:queryh | orderBy:'-timestamp'" ng-class="transaction.canceled && 'del'" ng-init="details = {show:false}">
                    <td class="time">{{ transaction.timestamp | date:'shortTime' }}</td>

                    <td class="type">
                        <ng:switch on="transaction.type">
                            <span ng-switch-when="buy">Achat de</span>
                            <a ng-switch-when="meal" tooltip="Loggué par {{ transaction.author.full_name }}" class="atooltip">
                                Achat de
                            </a>
                            <span ng-switch-when="appro">Appro de</span>
                            <span ng-switch-when="throw">Mise à la poubelle de</span>

                            <span ng-switch-when="give">Don de</span>
                            <a ng-switch-when="punish" tooltip="{{ transaction.motive }}" class="atooltip">Amende de</a>
                        </ng:switch>
                    </td>
                    <td class="item">
                        <ng:switch on="transaction.type">
                            <span ng-switch-when="buy">
                                <bars:food food="transaction.item" qty="transaction.qty" out="'sell'"></bars:food>
                            </span>
                            <span ng-switch-when="meal">
                                <a ng-show="transaction.items.length > 1 && !detailsFood" ng-click="detailsFood = true">
                                    {{ transaction.items.length }} aliments
                                </a>
                                <div collapse="transaction.items.length > 1 && !detailsFood">
                                    <div ng-repeat="x in transaction.items">
                                        <bars:food food="x.item" qty="x.qty" out="'sell'"></bars:food><br />
                                    </div>
                                </div>
                            </span>
                            <span ng-switch-when="appro">
                                <bars:food food="transaction.item" qty="transaction.qty" out="'sell'"></bars:food>
                            </span>
                            <span ng-switch-when="throw">
                                <bars:food food="transaction.item" qty="transaction.qty" out="'sell'"></bars:food>
                            </span>

                            <span ng-switch-when="give">
                                {{ transaction.amount | currency }} à <bars:account account="transaction.account"></bars:account>
                            </span>
                            <span ng-switch-when="punish">
                                {{ transaction.amount | abs | currency }} mise à <bars:account account="transaction.account"></bars:account>
                            </span>
                        </ng:switch>
                    </td>
                    <td class="par">par</td>
                    <td class="user">
                        <div ng-if="transaction.type == 'meal'">
                            <a ng-show="transaction.accounts.length > 1 && !detailsAccounts" ng-click="detailsAccounts = true">
                                {{ transaction.accounts.length }} personnes
                            </a>
                            <div collapse="transaction.accounts.length > 1 && !detailsAccounts">
                                <div ng-repeat="x in transaction.accounts">
                                    <bars:account account="x.account"></bars:account>
                                    <div class="pull-right" ng-if="transaction.accounts.length > 1">
                                        <span class="label" ng-class="transaction.canceled && 'label-default' || 'label-info'">{{ transaction.moneyflow*x.ratio | abs | currency }}</span>
                                    </div>
                                    <br />
                                </div>
                            </div>
                        </div>
                        <bars:user ng-if="transaction.type != 'meal'" user="transaction.author" bar_="transaction.bar"></bars:user>
                    </td>
                    <td class="price">
                        <span class="label" ng-class="transaction.canceled && 'label-default' || transaction.moneyflow < 0 && 'label-danger' || 'label-success'">
                            {{ transaction.moneyflow | abs | currency }}
                        </span>
                    </td>
                    <td class="buttons">
                        <a title="Annuler cette transaction" ng-if="!transaction.canceled" ng-click="transaction.cancel()" class="label label-warning">Annuler</a>
                        <a title="Rétablir cette transaction" ng-if="transaction.canceled" ng-click="transaction.restore()" class="label label-warning">Rétablir</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div></div>
